{{- if .Values.secrets.existingRedisSecret }}
  {{- /* When using existingRedisSecret, we don't create a secret, so no validation needed */ -}}
  {{- if or .Values.redis.auth.username .Values.redis.auth.password }}
    {{- fail "Error: 'secrets.existingRedisSecret' is set, but inline Redis auth values (redis.auth.username or redis.auth.password) are also provided. These options cannot be combined. Please remove the inline values or unset 'existingRedisSecret'." }}
  {{- end }}
  {{- /* Note: When existingRedisSecret is used, install.enabled can be true or false. 
         If true, Redis will be deployed but the secret will reference the existing secret.
         If false, Redis won't be deployed and the existing secret will be used. */ -}}
{{- else }}
  {{- /* Validation: ensure mutual exclusivity between internal and external Redis */ -}}
  {{- if not .Values.redis.install.enabled }}
    {{- if not .Values.redis.external.url }}
      {{- fail "Error: install.enabled is false, but redis.external.url is not provided. Please provide redis.external.url to use external Redis, or set install.enabled to true to use internal Redis." }}
    {{- end }}
  {{- else }}
    {{- if .Values.redis.external.url }}
      {{- fail "Error: install.enabled is true, but redis.external.url is also provided. These options are mutually exclusive. Please set install.enabled to false to use external Redis, or remove redis.external.url to use internal Redis." }}
    {{- end }}
  {{- end }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "adaptive.redis.secret.fullname" . }}
type: Opaque
data:
  redisUrl: {{ include "adaptive.redis.url" . | b64enc }}
{{- end }}

